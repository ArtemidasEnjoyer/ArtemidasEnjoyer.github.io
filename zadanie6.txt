-- 1.Napisz zapytanie zwracające liczbę filmów w tabeli film pogrupowanych według pola ocena.
SELECT COUNT(film.film_id), film.ocena
FROM film
GROUP BY film.ocena;

-- 2.Używając złączenia filmu z kategorią napisz zapytanie zwracające liczbę filmów w każdej kategorii.
SELECT COUNT(film.film_id) AS "ilość filmów", kategoria.nazwa
FROM film
JOIN film_kategoria ON film.film_id = film_kategoria.film_id
JOIN kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id
GROUP BY kategoria.nazwa;

-- 3.Używając złączenia tabeli film z film_aktor napisz zapytanie zwracające liczbę aktorów grających w każdym filmie.
SELECT COUNT(aktor.aktor_id),film.tytul
FROM film
JOIN film_aktor ON film_aktor.film_id = film.film_id
JOIN aktor ON aktor.aktor_id = film_aktor.aktor_id
GROUP BY film.tytul;

-- 4.Używając złączenia tabeli platnosc z klient oblicz sumę wszystkich płatności poszczególnych klientów.
SELECT SUM(platnosc.kwota) AS "Łączna kwota", klient.imie,klient.nazwisko
FROM klient
JOIN platnosc ON platnosc.klient_id = klient.klient_id
GROUP BY klient.imie;

-- 5.Używając złączenia tabel platnosc, wypozyczenie, spis i film oblicz sumę wszystkich płatności za film poszczególne filmy.
SELECT SUM(platnosc.kwota) AS "Płatność za film",film.tytul
FROM film
JOIN spis ON spis.film_id = film.film_id
JOIN wypozyczenie ON wypozyczenie.spis_id = spis.spis_id
JOIN platnosc ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
GROUP BY film.tytul;

-- 6. Używając złączenia tabel film_kategoria, kategoria i film oblicz średnia stawkę wypożyczenia i średni koszt wymiany filmu w każdej kategorii.
SELECT AVG(film.stawka_wypozycz) as 'Średnia stawka wypożyczenia',AVG(film.koszty_wymiany) AS 'Średni koszt wymiant', kategoria.nazwa
FROM film
JOIN film_kategoria ON film.film_id = film_kategoria.film_id
JOIN kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id
GROUP BY kategoria.nazwa;

-- 7. Używając złączenia tabeli platnosc z klient oblicz średnie kwoty płatności dla poszczególnych klientów.
SELECT AVG(platnosc.kwota) as "Średnia płatność",klient.imie,klient.nazwisko
FROM klient
JOIN platnosc ON platnosc.klient_id = klient.klient_id
GROUP BY klient.klient_id;

-- 8.Używając złączenia tabeli platnosc z pracownik oblicz średnie kwoty wypożyczenia filmów poszczególnych pracowników.
SELECT AVG(platnosc.kwota) AS "Średnia kwota wyp. filmow dla pracownika",pracownik.imie, pracownik.nazwisko
FROM pracownik
JOIN wypozyczenie ON wypozyczenie.pracownik_id = pracownik.pracownik_id
JOIN platnosc ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
GROUP BY pracownik.pracownik_id;

-- 9.Na podstawie danych w tabelach adres, sklep, pracownik, platnosc oblicz średnie kwoty sprzedaży filmów dla poszczególnych adresów sklepów
SELECT AVG(platnosc.kwota) AS "Średnia kwota dla sklepu",adres.adres,adres.adres2
FROM platnosc
JOIN pracownik ON platnosc.pracownik_id = pracownik.pracownik_id
JOIN sklep ON pracownik.sklep_id = sklep.sklep_id
JOIN adres ON adres.adres_id = sklep.sklep_id
GROUP BY sklep.sklep_id;

-- 10.Na podstawie danych z tabeli platnosc oblicz: średnią, maksymalną, minimalną płatność oraz sumę wszystkich płatności dla poszczególnych kategorii.
SELECT AVG(platnosc.kwota) AS "srednia kw",MAX(platnosc.kwota) AS "maks kw",MIN(platnosc.kwota) AS 'minimalna kw', SUM(platnosc.kwota) AS "suma kw", kategoria.nazwa
FROM kategoria
JOIN film_kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id 
JOIN film ON film.film_id = film_kategoria.film_id
JOIN spis ON spis.film_id = film.film_id
JOIN wypozyczenie ON wypozyczenie.spis_id = spis.spis_id
JOIN klient ON klient.klient_id = wypozyczenie.klient_id
JOIN platnosc ON platnosc.klient_id = klient.klient_id
GROUP BY kategoria.kategoria_id;

-- 11.Oblicz: sumę, maksymalną i minimalną kwotę płatności (z tabeli platnosc) dla poszczególnych klientów.
SELECT AVG(platnosc.kwota) AS "srednia kw",MAX(platnosc.kwota) AS "maks kw",MIN(platnosc.kwota) AS 'minimalna kw', SUM(platnosc.kwota) AS "suma kw", klient.imie, klient.nazwisko
FROM platnosc
JOIN klient ON klient.klient_id = platnosc.klient_id
GROUP BY klient.klient_id;

-- 12.Używając złączeń tabel: wypozyczenie i klient wypisz nazwiska klientów oraz ilości wypożyczonych przez nich filmów.
SELECT klient.imie, klient.nazwisko, COUNT(wypozyczenie.wypozyczenie_id) AS "Ilość wypożyczonych filmów"
FROM klient
JOIN wypozyczenie ON wypozyczenie.klient_id = klient.klient_id
GROUP BY klient.klient_id;

-- 13. Napisz zapytanie zwracające ilość płatności dokonanych przez poszczególnych klientów. Porównaj wynik z wynikiem z zadania 12.
SELECT klient.imie, klient.nazwisko , COUNT(platnosc.platnosc_id)
FROM klient
JOIN platnosc ON platnosc.klient_id = klient.klient_id
GROUP BY klient.klient_id;

-- 16.Na podstawie danych z tabeli platnosc oblicz wariancję, wariancję próby, średnią i odchylenie standardowe wszystkich płatności poszczególnych klientów.
SELECT VAR_POP(platnosc.kwota),VAR_SAMP(platnosc.kwota),AVG(platnosc.kwota), STDDEV_POP(platnosc.kwota), klient.imie
FROM platnosc
JOIN klient ON klient.klient_id = platnosc.klient_id
GROUP BY klient.klient_id;

-- 17.Na podstawie danych z tabeli platnosc oblicz wariancję, wariancję próby, średnią i odchylenie standardowe wszystkich płatności poszczególnych filmów.
SELECT VAR_POP(platnosc.kwota),VAR_SAMP(platnosc.kwota),AVG(platnosc.kwota), STDDEV_POP(platnosc.kwota), film.tytul
FROM platnosc
JOIN wypozyczenie ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
JOIN spis ON wypozyczenie.spis_id = spis.spis_id
JOIN film ON spis.film_id = film.film_id
GROUP BY film.tytul;

-- 18.Na podstawie danych z tabeli platnosc oblicz wariancję, wariancję próby, średnią i odchylenie standardowe wszystkich płatności dla filmów z poszczególnych kategorii.
SELECT VAR_POP(platnosc.kwota),VAR_SAMP(platnosc.kwota),AVG(platnosc.kwota), STDDEV_POP(platnosc.kwota), kategoria.nazwa
FROM platnosc
JOIN wypozyczenie ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
JOIN spis ON wypozyczenie.spis_id = spis.spis_id
JOIN film ON spis.film_id = film.film_id
JOIN film_kategoria ON film.film_id = film_kategoria.film_id
JOIN kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id
GROUP BY kategoria.nazwa;

-- 19. Używając złączenia tabel platnosc i klient oraz klauzuli HAVING napisz zapytanie zwracające listę klientów wraz z płatnościami, których suma kwot płatności była większa od 200.
SELECT klient.imie,klient.nazwisko,SUM(platnosc.kwota)
FROM klient
JOIN platnosc ON klient.klient_id = platnosc.klient_id
GROUP BY klient.imie
HAVING SUM(platnosc.kwota) > 200;

-- 20. Używając złączenia tabel platnosc, wypozyczenie, spis, film oraz klauzuli HAVING napisz zapytanie zwracające listę filmów wraz z płatnościami, których suma kwot płatności była większa od 200.
SELECT film.tytul, SUM(platnosc.kwota)
FROM film
JOIN spis ON spis.film_id = film.film_id
JOIN wypozyczenie ON wypozyczenie.spis_id = spis.spis_id
JOIN platnosc ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
GROUP BY film.tytul
HAVING SUM(platnosc.kwota) > 200;